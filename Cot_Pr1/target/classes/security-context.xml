<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
 xmlns:beans="http://www.springframework.org/schema/beans" 
 xmlns:context="http://www.springframework.org/schema/context"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xmlns:p="http://www.springframework.org/schema/p" xmlns:util="http://www.springframework.org/schema/util"
 xsi:schemaLocation="http://www.springframework.org/schema/beans 
  http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
  http://www.springframework.org/schema/security 
  http://www.springframework.org/schema/security/spring-security-3.1.xsd
  http://www.springframework.org/schema/util 
  http://www.springframework.org/schema/util/spring-util-3.1.xsd">

		
	
	<http auto-config="true" use-expressions="true" >
		<form-login login-page="/_top" 
			username-parameter="user_id"
			password-parameter="password" 
		
			authentication-success-handler-ref="signinSuccessHandler"
			authentication-failure-handler-ref="signinFailureHandler"
			default-target-url="/users/mypage" 
			always-use-default-target="false" />
			
		<logout invalidate-session="true" logout-success-url="/signin"
			logout-url="/signout" />
			<access-denied-handler ref="accessFailureHandler" />
	</http>
	
	<beans:bean id="signinSuccessHandler" class="net.cot_pr1.security.SigninSuccessHandler" />
	<beans:bean id="signinFailureHandler" class="net.cot_pr1.security.SigninFailureHandler">
		<beans:property name="defaultFailureUrl" value="/signin?error=true" />
	</beans:bean> 
	
	<beans:bean id="accessFailureHandler" class="net.cot_pr1.security.AccessFailureHandler">
	<beans:property name="errorPage" value="/403" />
	</beans:bean>

	<beans:bean id="customAuthenticationProvider" class="net.cot_pr1.security.CustomAuthenticationProvider" />

	<beans:bean id="userService" class="net.cot_pr1.service.UserService" />
<!--  전버전 서비스 
	<beans:bean id="user_sService" class="net.cot_pr1.security.User_sService" />
	-->
	<beans:bean id="passwordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"/>

	<beans:bean id="encoder" class="org.springframework.security.authentication.encoding.ShaPasswordEncoder" />
	<beans:bean id="saltSource" class="org.springframework.security.authentication.dao.ReflectionSaltSource">
		<beans:property name="userPropertyToUse" value="username" />
	</beans:bean>

	<authentication-manager alias="authenticationManager">
		<authentication-provider ref="customAuthenticationProvider" />
		<!--  
		<authentication-provider user-service-ref="userService">
			<password-encoder ref="encoder">
				<salt-source ref="saltSource" />
			</password-encoder>
		</authentication-provider>
		-->
	</authentication-manager>


</beans:beans> 